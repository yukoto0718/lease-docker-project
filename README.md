# ğŸ  è³ƒè²¸ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - AWS EC2 å®Œå…¨ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰

**æ—¥æœ¬èªç‰ˆ** | [ä¸­æ–‡ç‰ˆ](./readme_cn.md) | [English Version](./readme_en.md)

## ğŸ” ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ - æ©Ÿèƒ½ç´¹ä»‹ã¨æŠ€è¡“è©³ç´°
[lease-system-backend](https://github.com/yukoto0718/lease-system-backend.git)

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èƒŒæ™¯

**è³ƒè²¸ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ **ã¯ã€**Spring Boot + Vue.js + Docker**æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã§é–‹ç™ºã•ã‚ŒãŸãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«åŸºã¥ãå®Œå…¨ãªè³ƒè²¸ç®¡ç†ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚ã‚·ã‚¹ãƒ†ãƒ ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘H5ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ç®¡ç†è€…å‘ã‘ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§æ§‹æˆã•ã‚Œã€ç‰©ä»¶ç®¡ç†ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã€å†…è¦‹äºˆç´„ã€å¥‘ç´„ç®¡ç†ãªã©ã®å®Œå…¨ãªãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ­ã‚»ã‚¹ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯æ§‹æˆ

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Vue.js H5ãƒ¦ãƒ¼ã‚¶ãƒ¼ç«¯ + Vue.jsç®¡ç†ç”»é¢
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Spring Bootãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: MySQL 8.0 + Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: MinIOã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
- **Webã‚µãƒ¼ãƒãƒ¼**: Nginxãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·
- **ã‚³ãƒ³ãƒ†ãƒŠåŒ–**: Docker + Docker Compose
- **CI/CD**: GitHub Actionsè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤

---

## ä½“é¨“ç”¨URL

> æœ¬ãƒ‡ãƒ¢ã‚·ã‚¹ãƒ†ãƒ ã¯**AWS EC2 (t2.micro)**ç„¡æ–™æ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ãŠã‚Šã€æŠ€è¡“å±•ç¤ºã¨å­¦ç¿’äº¤æµç›®çš„ã®ã¿ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ã‚¯ã‚»ã‚¹
**ãƒ¢ãƒã‚¤ãƒ«ç«¯**: http://57.183.57.12

ãƒ¦ãƒ¼ã‚¶ãƒ¼â‘ ï¼š`ãƒ¦ãƒ¼ã‚¶ãƒ¼å 13112345678 / ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ 123456`
ãƒ¦ãƒ¼ã‚¶ãƒ¼â‘¡ï¼š`ãƒ¦ãƒ¼ã‚¶ãƒ¼å 13212345678 / ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ 123456`
ãƒ¦ãƒ¼ã‚¶ãƒ¼â‘¢ï¼š`ãƒ¦ãƒ¼ã‚¶ãƒ¼å 13312345678 / ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ 123456`

### ç®¡ç†ç”»é¢
**ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ **: http://57.183.57.12:8888

`ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼šuser / ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼š123456`

### MINIO
**MinIOã‚³ãƒ³ã‚½ãƒ¼ãƒ«**: http://57.183.57.12:9001

`ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼šminioadmin / ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼šminioadmin`

## ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### 1. AWS EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆ

**ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹è¨­å®šè¦ä»¶**

> ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å: lease-production-server
> AMI: Amazon Linux 2023 AMI (Free tier eligible)
> ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—: t2.micro (Free tier eligible)
> ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ: lease-server-sg
> ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: 30GB (Free tier)
> å›ºå®šIP: Allocate Elastic IP addressã‚’æœ‰åŠ¹åŒ–

| ã‚¿ã‚¤ãƒ— | ãƒ—ãƒ­ãƒˆã‚³ãƒ« | ãƒãƒ¼ãƒˆç¯„å›² | ã‚½ãƒ¼ã‚¹ | èª¬æ˜ |
|------|----------|------------|---------|-------------|
| SSH | TCP | 22 | My IP | SSHã‚¢ã‚¯ã‚»ã‚¹ |
| HTTP | TCP | 80 | 0.0.0.0/0 | H5ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ |
| Custom TCP | TCP | 8080 | 0.0.0.0/0 | Admin API |
| Custom TCP | TCP | 8081 | 0.0.0.0/0 | App API |
| Custom TCP | TCP | 8888 | 0.0.0.0/0 | Admin ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ |
| Custom TCP | TCP | 9001 | 0.0.0.0/0 | MinIOã‚³ãƒ³ã‚½ãƒ¼ãƒ« |
| Custom TCP | TCP | 8082 | 0.0.0.0/0 | Adminer |
| Custom TCP | TCP | 9000 | 0.0.0.0/0 | MinIO API |

## ã‚¹ãƒ†ãƒƒãƒ—2ï¼šEC2æ¥ç¶šã¨åŸºæœ¬ç’°å¢ƒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

**2.1 SSHæ¥ç¶š**
```powershell
# Windows PowerShell
cd C:\aws-keys\
ssh -i lease-server-key.pem ec2-user@ã‚ãªãŸã®EC2ãƒ‘ãƒ–ãƒªãƒƒã‚¯IP
2.2 å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
bash# ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°
sudo yum update -y
```

Dockerã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```
sudo yum install docker -y
sudo systemctl start docker
sudo systemctl enable docker
sudo usermod -a -G docker ec2-user
```

Docker Composeã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

Gitã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```
sudo yum install git -y
```

Dockerã‚°ãƒ«ãƒ¼ãƒ—æ¨©é™ã‚’é©ç”¨ã™ã‚‹ãŸã‚é€€å‡º
```
exit
```

## ã‚¹ãƒ†ãƒƒãƒ—3ï¼šSwapã‚¹ãƒšãƒ¼ã‚¹è¨­å®šï¼ˆé‡è¦ãªã‚¹ãƒ†ãƒƒãƒ—ï¼‰
ãªãœSwapãŒå¿…è¦ï¼Ÿ
t2.microã¯1GBãƒ¡ãƒ¢ãƒªã®ã¿ã§ã€7ã¤ã®Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã™ã‚‹ã¨ãƒ¡ãƒ¢ãƒªåˆ¶é™ã‚’è¶…ãˆã€ã‚·ã‚¹ãƒ†ãƒ ãŒãƒ•ãƒªãƒ¼ã‚ºã—ã¾ã™ã€‚
**3.1 å†æ¥ç¶šã¨Swapè¨­å®š**
```bash
# å†æ¥ç¶š
ssh -i lease-server-key.pem ec2-user@ã‚ãªãŸã®EC2ãƒ‘ãƒ–ãƒªãƒƒã‚¯IP
```

2GB Swapãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
```
sudo dd if=/dev/zero of=/swapfile bs=1024 count=2097152
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

SwapãŒæœ‰åŠ¹ã‹ç¢ºèª
```
free -h
èµ·å‹•æ™‚è‡ªå‹•ãƒã‚¦ãƒ³ãƒˆè¨­å®š
echo '/swapfile none swap defaults 0 0' | sudo tee -a /etc/fstab
æˆåŠŸæŒ‡æ¨™ï¼š
Mem:   949Mi    192Mi     69Mi   0.0Ki   686Mi   608Mi
Swap:  2.0Gi       0B    2.0Gi
```

## ã‚¹ãƒ†ãƒƒãƒ—4ï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¯ãƒ­ãƒ¼ãƒ³ã¨è¨­å®š
**4.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰ã‚¯ãƒ­ãƒ¼ãƒ³**
```bash
# GitHub Tokenã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://ã‚ãªãŸã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å:ã‚ãªãŸã®Token@github.com/ã‚ãªãŸã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å/lease-docker-project.git
cd lease-docker-project
```

**4.2 è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª**
```bash
# IPè¨­å®šç¢ºèª
grep "MINIO_ENDPOINT" docker-compose.fixed.yml
```

ç’°å¢ƒå¤‰æ•°ç¢ºèª
```
cat .env
```

ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ¨©é™è¨­å®š
```
sudo chown -R 999:999 data/mysql/
sudo chown -R 1000:1000 data/minio/
sudo chown -R 999:999 data/redis/
```

## ã‚¹ãƒ†ãƒƒãƒ—5ï¼šæ®µéšçš„Dockerã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ãƒ—ãƒ­ã‚¤
ãªãœæ®µéšçš„ãƒ‡ãƒ—ãƒ­ã‚¤ï¼Ÿ
7ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’åŒæ™‚èµ·å‹•ã—ã¦ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚’é¿ã‘ã‚‹
MySQLãŒååˆ†ãªæ™‚é–“ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆæœŸåŒ–ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³ã®ç›£è¦–ã¨å•é¡Œã®æ’é™¤ãŒå®¹æ˜“

**5.1 ã‚³ã‚¢ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•**
```bash
# MySQLã¨Redisèµ·å‹•
docker-compose -f docker-compose.fixed.yml up -d mysql redis
sleep 60
```

ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
```
docker ps
free -h
```

**5.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†èµ·å‹•**
```bash
# Adminerèµ·å‹•
docker-compose -f docker-compose.fixed.yml up -d adminer
sleep 30
```
**5.3 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•**
```bash
# Spring Bootã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
docker-compose -f docker-compose.fixed.yml up -d web-admin web-app
sleep 30
```
**5.4 ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•**
```bash
# MinIOèµ·å‹•
docker-compose -f docker-compose.fixed.yml up -d minio
sleep 30
```
**5.5 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•**
```bash# Nginxèµ·å‹•
docker-compose -f docker-compose.fixed.yml up -d nginx
sleep 30
```

# æœ€çµ‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
```
docker ps
free -h
```
æˆåŠŸæŒ‡æ¨™ï¼š7ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã™ã¹ã¦ãŒå®Ÿè¡Œä¸­

## ã‚¹ãƒ†ãƒƒãƒ—6ï¼šãƒ‡ãƒ—ãƒ­ã‚¤æ¤œè¨¼
**6.1 ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚¯ã‚»ã‚¹**
```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒšãƒ¼ã‚¸: http://ã‚ãªãŸã®EC2ãƒ‘ãƒ–ãƒªãƒƒã‚¯IP
ç®¡ç†ç”»é¢: http://ã‚ãªãŸã®EC2ãƒ‘ãƒ–ãƒªãƒƒã‚¯IP:8888
MinIOã‚³ãƒ³ã‚½ãƒ¼ãƒ«: http://ã‚ãªãŸã®EC2ãƒ‘ãƒ–ãƒªãƒƒã‚¯IP:9001
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†: http://ã‚ãªãŸã®EC2ãƒ‘ãƒ–ãƒªãƒƒã‚¯IP:8082
```

**6.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ãƒ­ã‚°ã‚¤ãƒ³**
```
Adminerãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ï¼š
ã‚·ã‚¹ãƒ†ãƒ : MySQL
ã‚µãƒ¼ãƒãƒ¼: mysql
ãƒ¦ãƒ¼ã‚¶ãƒ¼å: root
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: Atguigu.123
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: lease
```

**6.3 ç”»åƒè¡¨ç¤ºä¿®æ­£**
ç”»åƒãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã€Adminerã§å®Ÿè¡Œï¼š
```sql
sqlUPDATE file_management 
SET url = REPLACE(url, 'http://æ—§IP:9000', 'http://ã‚ãªãŸã®EC2ãƒ‘ãƒ–ãƒªãƒƒã‚¯IP:9000') 
WHERE url LIKE '%æ—§IP%';
```
æ³¨æ„ï¼šuser_infoã€blog_graph_infoã€graph_infoãƒ†ãƒ¼ãƒ–ãƒ«ã‚‚å¯¾å¿œã™ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å¤‰æ›´ãŒå¿…è¦ã§ã™ã€‚