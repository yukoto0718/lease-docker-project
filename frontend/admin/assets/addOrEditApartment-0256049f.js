import{A as E,g as M,b as j,B as J}from"./constEnums-bbb5bb0e.js";import{a as me,e as ve,f as ge,h as ye,i as Ie,b as be,c as _e,s as Ve}from"./index-99c15efc.js";import{a as P}from"./index-4a51e267.js";import{r as b,K as G,d as Le,f as he,x as Ce,S as z,a as f,o as u,h as I,i as s,l as w,t as D,e as o,c as L,B as h,F as C,O as m,b as N,n as Ee,z as O,_ as xe}from"./index-713ae778.js";import{_ as Ae}from"./uploadImg.vue_vue_type_script_setup_true_lang-528528b5.js";const ke=()=>{const R=b(!1),x=async(_,a="jp")=>{try{return(await P.get("https://nominatim.openstreetmap.org/search",{params:{q:_,format:"json",addressdetails:1,countrycodes:a,limit:10,"accept-language":"ja"}})).data}catch(v){return console.error("Error searching address:",v),[]}},A=async(_,a)=>{try{return(await P.get("https://nominatim.openstreetmap.org/reverse",{params:{lat:_,lon:a,format:"json",addressdetails:1},headers:{"Accept-Language":"ja","User-Agent":"RentApartmentApp/1.0"}})).data}catch(v){return console.error("Error reverse geocoding:",v),null}};return G(()=>{R.value=!0}),{isLoaded:R,searchAddress:x,reverseGeocode:A}},we={class:"card-header"},De={class:"flex-center"},Ne={class:"flex-center m-t-20"},Re=Le({__name:"addOrEditApartment",setup(R){const x=he(),A=Ce(),_=b(),a=b({id:"",name:"",introductionCn:"",introductionEn:"",introductionJa:"",districtId:"",districtName:"",cityId:"",cityName:"",provinceId:"",provinceName:"",addressDetail:"",latitude:"",longitude:"",phone:"",isRelease:E.NOT_RELEASED,facilityInfoIds:[],labelIds:[],feeValueIds:[],graphVoList:[]}),v=z({name:[{required:!0,message:"请输入アパート名称",trigger:"blur"}],introductionCn:[{required:!0,message:"请输入アパート介绍",trigger:"blur"}],introductionEn:[{required:!0,message:"请输入アパート英語介绍",trigger:"blur"}],introductionJa:[{required:!0,message:"请输入アパート日本語介绍",trigger:"blur"}],provinceId:[{required:!0,message:"都道府県をお願いします。",trigger:"change"}],cityId:[{required:!0,message:"市区町村をお願いします。",trigger:"change"}],districtId:[{required:!0,message:"エリアを選択してください",trigger:"change"}],addressDetail:[{required:!0,message:"请选择詳細住所",trigger:"change"}],phone:[{required:!0,message:"アパート前台电话を入力してください",trigger:"blur"}],graphVoList:[{required:!0,message:"请上传画像",trigger:"change"}]}),p=z({provinceList:[],cityList:[],districtList:[]});async function K(){try{const{data:l}=await me();p.provinceList=l}catch(l){console.log(l)}}async function H(l=a.value.provinceId){if(l)try{const{data:e}=await be(l);p.cityList=e}catch(e){console.log(e)}}async function S(l=a.value.cityId){if(l)try{const{data:e}=await _e(l);p.districtList=e}catch(e){console.log(e)}}function T(){a.value.cityId="",p.cityList=[]}function k(){a.value.districtId="",p.districtList=[]}const Q=async()=>{let l=a.value.provinceId;l&&(T(),k(),await H(l))},W=()=>{a.value.provinceId="",T(),k()},X=async()=>{let l=a.value.cityId;l&&(k(),await S(l))},Y=()=>{console.log("都市選択をクリア"),a.value.cityId="",k()},Z=async()=>{console.log("エリア変更")},ee=()=>{console.log("エリア選択をクリア"),a.value.districtId=""},V=b([]),{searchAddress:ae}=ke();function te(l,e){let i=0;return function(...r){const n=new Date().getTime();if(!(n-i<e))return i=n,l(...r)}}const le=te(async l=>{var e,i,r;if(l.trim())try{const n=((e=p.provinceList.find(c=>c.id===a.value.provinceId))==null?void 0:e.name)||"",d=((i=p.cityList.find(c=>c.id===a.value.cityId))==null?void 0:i.name)||"",g=((r=p.districtList.find(c=>c.id===a.value.districtId))==null?void 0:r.name)||"";let y="";n&&(y+=n),d&&(y+=` ${d}`),g&&(y+=` ${g}`),l&&(y+=` ${l}`);const q=await ae(y.trim());V.value=q.map(c=>({label:c.display_name,value:c.display_name,location:{lng:c.lon,lat:c.lat}}))}catch(n){console.error("Error searching address:",n),V.value=[],O.error("アドレス検索失敗，後ほどリトライをお願いします。")}else V.value=[]},1e3);function ne(l){var i,r;const e=V.value.find(n=>n.value===l);e&&(a.value.longitude=Number((i=e.location)==null?void 0:i.lng).toFixed(6)||"",a.value.latitude=Number((r=e.location)==null?void 0:r.lat).toFixed(6)||"")}const B=b([]),$=b([]),U=b([]);async function re(){try{const{data:l}=await ve(J.APARTMENT);B.value=l}catch(l){console.log(l)}}async function oe(){try{const{data:l}=await ge(J.APARTMENT);$.value=l}catch(l){console.log(l)}}async function se(){try{const{data:l}=await ye();U.value=l.map(e=>({value:e.id+e.name,label:e.name,children:e.feeValueList.map(i=>({value:i.id,label:`${i.name} ${i.unit}(${e.name})`,parentId:e.id+e.name}))}))}catch(l){console.log(l)}}function ie(l){var e,i;if(l.parentId){const r=(i=(e=U.value.find(n=>n.value===l.parentId))==null?void 0:e.children)==null?void 0:i.map(n=>n.value);Ee(()=>{var n,d;a.value.feeValueIds=(n=a.value.feeValueIds)==null?void 0:n.filter(g=>!(r!=null&&r.includes(g))),(d=a.value.feeValueIds)==null||d.push(l.value)})}}function de(l,e,i){a.value.graphVoList=i==null?void 0:i.map(r=>{var n;return{...r,url:((n=r==null?void 0:r.response)==null?void 0:n.data)||r.url}})}async function ue(l){var e,i,r;try{const{data:n}=await Ie(l);n.facilityInfoIds=(e=n.facilityInfoList)==null?void 0:e.map(d=>d.id),delete n.facilityInfoList,n.labelIds=(i=n.labelInfoList)==null?void 0:i.map(d=>d.id),delete n.labelInfoList,n.feeValueIds=(r=n.feeValueVoList)==null?void 0:r.map(d=>d.id),delete n.feeValueVoList,V.value=[{label:n.addressDetail,value:n.addressDetail,location:{lng:n.longitude,lat:n.latitude}}],a.value=n,console.log(a.value.provinceId,a.value.cityId),a.value.provinceId&&H(a.value.provinceId),a.value.cityId&&S(a.value.cityId)}catch(n){console.log(n)}}async function ce(){try{await Ve(a.value),O.success("操作が成功しました"),A.back()}catch(l){console.log(l)}}function pe(){var l;(l=_.value)==null||l.validate(async e=>{if(e)await ce();else return O.error("入力内容に誤りがあります。，確認してください"),!1})}return G(()=>{var l;K(),re(),oe(),se(),(l=x.query)!=null&&l.id&&ue(x.query.id)}),(l,e)=>{const i=f("el-input"),r=f("el-form-item"),n=f("el-option"),d=f("el-select"),g=f("el-radio"),y=f("el-radio-group"),q=f("el-tree-select"),c=f("el-form"),F=f("el-button"),fe=f("el-card");return u(),I(fe,null,{header:s(()=>[w("div",we,[w("span",null,D(a.value.id?"編集":"新規追加")+"アパート",1)])]),default:s(()=>[o(c,{ref_key:"apartmentFormRef",ref:_,model:a.value,rules:v,"label-width":"120px",style:{"max-width":"660px"},"status-icon":""},{default:s(()=>[o(r,{label:"アパート名称",prop:"name"},{default:s(()=>[o(i,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>a.value.name=t)},null,8,["modelValue"])]),_:1}),o(r,{label:"アパート介绍(中文)",prop:"introductionCn"},{default:s(()=>[o(i,{type:"textarea",modelValue:a.value.introductionCn,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.introductionCn=t),class:"apartment-intro-textarea"},null,8,["modelValue"])]),_:1}),o(r,{label:"アパート介绍(英語)",prop:"introductionEn"},{default:s(()=>[o(i,{type:"textarea",modelValue:a.value.introductionEn,"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.introductionEn=t),class:"apartment-intro-textarea"},null,8,["modelValue"])]),_:1}),o(r,{label:"アパート介绍(日本語)",prop:"introductionJa"},{default:s(()=>[o(i,{type:"textarea",modelValue:a.value.introductionJa,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.introductionJa=t),class:"apartment-intro-textarea"},null,8,["modelValue"])]),_:1}),o(r,{label:"所在エリア",required:""},{default:s(()=>[w("div",De,[o(r,{prop:"provinceId"},{default:s(()=>[o(d,{modelValue:a.value.provinceId,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.provinceId=t),placeholder:"都道府県をお願いします。",clearable:"",onChange:Q,onClear:W},{default:s(()=>[(u(!0),L(C,null,h(p.provinceList,t=>(u(),I(n,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(r,{prop:"cityId"},{default:s(()=>[o(d,{modelValue:a.value.cityId,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.cityId=t),placeholder:"市区町村をお願いします。",clearable:"",onChange:X,onClear:Y},{default:s(()=>[(u(!0),L(C,null,h(p.cityList,t=>(u(),I(n,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(r,{prop:"districtId"},{default:s(()=>[o(d,{modelValue:a.value.districtId,"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.districtId=t),placeholder:"エリアを選択してください",clearable:"",onChange:Z,onClear:ee},{default:s(()=>[(u(!0),L(C,null,h(p.districtList,t=>(u(),I(n,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),_:1}),o(r,{label:"詳細住所",prop:"addressDetail"},{default:s(()=>[o(d,{modelValue:a.value.addressDetail,"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.addressDetail=t),filterable:"",remote:"",clearable:"",placeholder:"请输入詳細住所查询","remote-method":m(le),style:{width:"100%"},onChange:ne},{default:s(()=>[(u(!0),L(C,null,h(V.value,t=>(u(),I(n,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","remote-method"])]),_:1}),o(r,{label:"アパート前台电话",prop:"phone"},{default:s(()=>[o(i,{modelValue:a.value.phone,"onUpdate:modelValue":e[8]||(e[8]=t=>a.value.phone=t)},null,8,["modelValue"])]),_:1}),o(r,{label:"発表するかどうか",prop:"isRelease"},{default:s(()=>[o(y,{modelValue:a.value.isRelease,"onUpdate:modelValue":e[9]||(e[9]=t=>a.value.isRelease=t),class:"ml-4"},{default:s(()=>[o(g,{label:m(E).NOT_RELEASED},{default:s(()=>[N(D(m(M)(m(j),m(E).NOT_RELEASED)),1)]),_:1},8,["label"]),o(g,{label:m(E).RELEASED},{default:s(()=>[N(D(m(M)(m(j),m(E).RELEASED)),1)]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}),o(r,{label:"アパート配套",prop:"facilityInfoIds"},{default:s(()=>[o(d,{style:{width:"100%"},modelValue:a.value.facilityInfoIds,"onUpdate:modelValue":e[10]||(e[10]=t=>a.value.facilityInfoIds=t),placeholder:"请选择アパート配套",multiple:"",clearable:""},{default:s(()=>[(u(!0),L(C,null,h(B.value,t=>(u(),I(n,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(r,{label:"アパート标签",prop:"labelIds"},{default:s(()=>[o(d,{style:{width:"100%"},modelValue:a.value.labelIds,"onUpdate:modelValue":e[11]||(e[11]=t=>a.value.labelIds=t),placeholder:"请选择アパート标签",multiple:"",clearable:""},{default:s(()=>[(u(!0),L(C,null,h($.value,t=>(u(),I(n,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(r,{label:"アパート杂费",prop:"feeValueIds"},{default:s(()=>[o(q,{style:{width:"100%"},modelValue:a.value.feeValueIds,"onUpdate:modelValue":e[12]||(e[12]=t=>a.value.feeValueIds=t),placeholder:"请选择アパート杂费",data:U.value,multiple:"",clearable:"","node-key":"value","render-after-expand":!1,onNodeClick:ie},null,8,["modelValue","data"])]),_:1}),o(r,{label:"画像",prop:"graphVoList"},{default:s(()=>[o(Ae,{"file-list":a.value.graphVoList,"onUpdate:fileList":e[13]||(e[13]=t=>a.value.graphVoList=t),"on-success":de,"list-type":"picture-card",limit:5},null,8,["file-list"])]),_:1})]),_:1},8,["model","rules"]),w("div",Ne,[o(F,{style:{width:"150px"},type:"info",onClick:e[14]||(e[14]=t=>m(A).back())},{default:s(()=>[N(" キャンセル ")]),_:1}),o(F,{style:{width:"150px"},type:"primary",onClick:pe},{default:s(()=>[N(D(a.value.id?"保存し":"新規追加"),1)]),_:1})])]),_:1})}}});const Te=xe(Re,[["__scopeId","data-v-80040cdf"]]);export{Te as default};
