import{S as q,g as G,a as T}from"./constEnums-bbb5bb0e.js";import{c as Q,g as W,a as X,u as Y,b as Z,d as ee,e as le,f as te,h as ae}from"./index-f6e011f4.js";import{d as B,r as v,S as R,w as oe,a as m,o as p,h as f,i as r,e as u,b,k as g,c as L,B as U,F as S,O as M,z as x,t as E,K as re,a0 as se}from"./index-713ae778.js";import{u as A}from"./useHandleData-f763eae5.js";import"./index-4a51e267.js";const ne=B({__name:"UserDrawer",setup(k,{expose:_}){const D=v({}),w=v(!1),l=v({title:""}),y=v(!1),V=R({username:[{required:!0,validator:async(o,e,n)=>{if(!e)return n(new Error("请输入ユーザー名"));if(e.length<4)return n(new Error("ユーザー名不能小于4位"));if(e.length>20)return n(new Error("ユーザー名不能大于20位"));if(e===D.value.username)return n();try{const{data:d}=await Q(e);if(!d)return n(new Error("ユーザー名已存在"));n()}catch(d){console.error(d),n(new Error("ユーザー名校验失败"))}},trigger:"blur"}],password:[{required:!0,message:"请填写ユーザー密码",trigger:"blur"},{min:6,message:"パスワードは小さくできません6位"}],confirmPassword:[{validator:async(o,e,n)=>{var d;return e===((d=l.value.rowData)==null?void 0:d.password)?n():n(new Error("2回入力してもパスワードが一致しません"))},trigger:"blur"}],name:[{required:!0,message:"请填写ユーザー昵称",trigger:"blur"}],phone:[{required:!0,message:"请填写ユーザー携帯電話",trigger:"blur"}],postId:[{required:!0,message:"请选择所属役職",trigger:"change"}],type:[{required:!0,message:"请选择ユーザー类型",trigger:"change"}]});oe(l,o=>{o&&(V.password[0].required=o.title==="新規追加")},{immediate:!0,deep:!0});const s=R({allRolesList:[],assginRoleList:[],checkAll:!1,isIndeterminate:!1}),C=o=>{s.assginRoleList=o?s.allRolesList.map(e=>e.id):[],console.log(s.assginRoleList),s.isIndeterminate=!1},t=o=>{const e=o.length;s.checkAll=e===s.allRolesList.length,s.isIndeterminate=e>0&&e<s.allRolesList.length},i=o=>{if(D.value=JSON.parse(JSON.stringify(o.rowData)),o.title==="編集"&&(o.rowData.password="",o.rowData.confirmPassword=""),o.title==="役割を割り当て"){const{list:e}=o;s.allRolesList=e.data,s.assginRoleList=e==null?void 0:e.data.filter(n=>n.selected).map(n=>n.id),s.isIndeterminate=s.assginRoleList.length>0}l.value=o,w.value=!0},c=v(),h=()=>{c.value.validate(async o=>{if(console.log("valid",o),!!o)try{if(y.value=!0,l.value.title==="役割を割り当て"){const e={userId:l.value.rowData.id,roleIdList:s.assginRoleList};await l.value.api(e)}else await l.value.api(l.value.rowData);x.success({message:`${l.value.title}操作が成功しました！`}),l.value.getTableList(),w.value=!1,y.value=!1}catch(e){y.value=!1,console.log(e)}})};return _({acceptParams:i}),(o,e)=>{const n=m("el-input"),d=m("el-form-item"),O=m("el-option"),F=m("el-select"),j=m("el-radio"),H=m("el-radio-group"),I=m("el-checkbox"),z=m("el-checkbox-group"),J=m("el-form"),N=m("el-button"),K=m("el-drawer");return p(),f(K,{modelValue:w.value,"onUpdate:modelValue":e[10]||(e[10]=a=>w.value=a),"destroy-on-close":!0,size:"450px",title:`${l.value.title}ユーザー`},{footer:r(()=>[u(N,{onClick:e[9]||(e[9]=a=>w.value=!1)},{default:r(()=>[b("キャンセル")]),_:1}),u(N,{type:"primary",onClick:h,loading:y.value},{default:r(()=>[b(" 確定 ")]),_:1},8,["loading"])]),default:r(()=>[u(J,{ref_key:"ruleFormRef",ref:c,"label-width":"120px","label-suffix":" :",rules:V,model:l.value.rowData},{default:r(()=>[u(d,{label:"ユーザー名",prop:"username"},{default:r(()=>[u(n,{disabled:l.value.title==="役割を割り当て",modelValue:l.value.rowData.username,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.rowData.username=a),modelModifiers:{trim:!0},placeholder:"请填写ユーザー姓名",clearable:""},null,8,["disabled","modelValue"])]),_:1}),l.value.title==="新規追加"||l.value.title==="編集"?(p(),f(d,{key:0,label:l.value.title==="編集"?"修改ユーザー密码":"ユーザー密码",prop:"password"},{default:r(()=>[u(n,{modelValue:l.value.rowData.password,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.rowData.password=a),modelModifiers:{trim:!0},placeholder:"请填写ユーザー密码",clearable:""},null,8,["modelValue"])]),_:1},8,["label"])):g("",!0),l.value.title==="編集"?(p(),f(d,{key:1,label:"パスワードを確認し",prop:"confirmPassword"},{default:r(()=>[u(n,{modelValue:l.value.rowData.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.rowData.confirmPassword=a),modelModifiers:{trim:!0},placeholder:"请再次填写ユーザー密码",clearable:""},null,8,["modelValue"])]),_:1})):g("",!0),l.value.title!=="役割を割り当て"?(p(),f(d,{key:2,label:"ユーザー昵称",prop:"name"},{default:r(()=>[u(n,{modelValue:l.value.rowData.name,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.rowData.name=a),modelModifiers:{trim:!0},placeholder:"请填写ユーザー昵称",clearable:""},null,8,["modelValue"])]),_:1})):g("",!0),l.value.title!=="役割を割り当て"?(p(),f(d,{key:3,label:"携帯電話",prop:"phone"},{default:r(()=>[u(n,{modelValue:l.value.rowData.phone,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.rowData.phone=a),modelModifiers:{trim:!0},placeholder:"请填写ユーザー携帯電話",clearable:""},null,8,["modelValue"])]),_:1})):g("",!0),l.value.title!=="役割を割り当て"?(p(),f(d,{key:4,label:"役職",prop:"postId"},{default:r(()=>[u(F,{modelValue:l.value.rowData.postId,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.rowData.postId=a),placeholder:"请选择役職",clearable:"",style:{width:"95%"}},{default:r(()=>[(p(!0),L(S,null,U(l.value.postList,a=>(p(),f(O,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0),l.value.title!=="役割を割り当て"?(p(),f(d,{key:5,label:"ユーザー类型",prop:"type"},{default:r(()=>[u(H,{modelValue:l.value.rowData.type,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.rowData.type=a)},{default:r(()=>[(p(!0),L(S,null,U(M(q),a=>(p(),f(j,{label:a.value,key:a.value},{default:r(()=>[b(E(a.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0),l.value.title==="役割を割り当て"?(p(),f(d,{key:6,label:"登場人物一覧",prop:"rolesId"},{default:r(()=>[u(I,{modelValue:s.checkAll,"onUpdate:modelValue":e[7]||(e[7]=a=>s.checkAll=a),indeterminate:s.isIndeterminate,onChange:C},{default:r(()=>[b(" 全選 ")]),_:1},8,["modelValue","indeterminate"]),u(z,{modelValue:s.assginRoleList,"onUpdate:modelValue":e[8]||(e[8]=a=>s.assginRoleList=a),onChange:t},{default:r(()=>[(p(!0),L(S,null,U(s.allRolesList,a=>(p(),f(I,{key:a.id,label:a.id},{default:r(()=>[b(E(a.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}});function ue(k){return typeof k=="function"||Object.prototype.toString.call(k)==="[object Object]"&&!se(k)}const fe=B({__name:"user",setup(k){const _=v(),D=R({}),w=t=>({list:t==null?void 0:t.records,total:t==null?void 0:t.total}),l=v(),y=async(t,i={})=>{var h;let c={title:t,rowData:{...i},api:t==="新規追加"?X:t==="編集"?Y:Z,getTableList:(h=_.value)==null?void 0:h.getTableList,postList:V.value};console.log(c),l.value.acceptParams(c)},P=async t=>{var i;if((t==null?void 0:t.username)==="admin"){x({type:"warning",message:"系统ユーザー不允许削除"});return}await A(ee,t.id,`削除${t.username}ユーザー`),(i=_.value)==null||i.getTableList()},$=async t=>{var i,c;await A(ae,t,"削除所选ユーザー信息"),(i=_.value)==null||i.clearSelection(),(c=_.value)==null||c.getTableList()},V=v([]),s=async()=>{try{const t=await le();V.value=t.data}catch(t){console.log(t),x.error((t==null?void 0:t.message)||"Has Error")}},C=[{type:"index",label:"番号"},{prop:"name",label:"従業員名",search:{el:"input",props:{placeholder:"输入従業員名"}}},{prop:"phone",label:"携帯電話番号",search:{el:"input",props:{placeholder:"输入携帯電話番号"}}},{prop:"postName",label:"役職"},{prop:"type",label:"ユーザー类型",render:({row:t})=>{let i;return u(m("el-tag"),{className:"flex-wrap m-r-10 m-t-5"},ue(i=G(q,t.type))?i:{default:()=>[i]})}},{prop:"status",label:"状態",width:100,render:({row:t})=>u(m("el-switch"),{"active-value":T.NORMAL,"inactive-value":T.DISABLED,modelValue:t.status,"onUpdate:modelValue":i=>t.status=i,onChange:()=>te(t.id,t.status)},null)},{prop:"operation",label:"操作",fixed:"right",width:280}];return re(()=>{s()}),(t,i)=>{const c=m("el-button"),h=m("ProTable");return p(),L("div",null,[u(h,{ref_key:"proTable",ref:_,dataCallback:w,columns:C,requestApi:M(W),initParam:D},{tableHeader:r(o=>[u(c,{type:"primary",icon:"Plus",onClick:i[0]||(i[0]=e=>y("新規追加"))},{default:r(()=>[b(" 追加し ")]),_:1}),g("",!0)]),operation:r(o=>[u(c,{type:"primary",link:"",icon:"Edit",onClick:e=>y("編集",o.row)},{default:r(()=>[b(" 編集 ")]),_:2},1032,["onClick"]),u(c,{type:"primary",link:"",icon:"Delete",onClick:e=>P(o.row)},{default:r(()=>[b(" 削除 ")]),_:2},1032,["onClick"])]),_:1},8,["requestApi","initParam"]),u(ne,{ref_key:"drawerRef",ref:l},null,512)])}}});export{fe as default};
