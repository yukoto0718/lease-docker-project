import{d as v,u as w,k as F,r as V,au as C,f as $,b as i,s as B,e as m,w as p,F as L,x as u,av as k,a as D,t as f,h as P,p as U,aw as R,B as q,_ as A}from"./index-b744bed0.js";import{U as E}from"./index-c65fce34.js";import{F as I}from"./index-ede2df1d.js";import{s as N}from"./index-58f473f0.js";import{F as S}from"./index-6f272d29.js";import"./function-call-69531997.js";import"./index-515de819.js";import"./index-beccc506.js";const T={class:"create-post"},x={class:"form-container"},z={class:"upload-section"},G={class:"upload-title"},M={style:{margin:"16px"}},j=v({__name:"CreatePost",setup(H){const{t:s}=w(),d=F(),c=V(!1),n=C({title:"",content:"",imageList:[]}),g=e=>{(Array.isArray(e)?e:[e]).forEach(async o=>{o.status="uploading",o.message=s("common.loading");try{const a=new FormData;a.append("file",o.file),console.log("开始上传文件:",o.file.name,"大小:",o.file.size);const l=await U.post("/app/file/upload",a,{headers:{"Content-Type":"multipart/form-data"}});if(console.log("上传响应:",l),l.code===200&&l.data)o.status="done",o.message="",o.url=l.data,console.log("文件上传成功，URL:",l.data);else throw new Error(l.message||s("community.post.uploadFailed"))}catch(a){console.error("文件上传错误:",a),o.status="failed",o.message=s("community.post.uploadFailed"),u(s("community.post.uploadFailed"))}})},y=()=>new Promise(e=>{R({title:s("community.post.deleteConfirmTitle"),message:s("community.post.deleteConfirmMessage"),showCancelButton:!0}).then(()=>{e(!0)}).catch(()=>{e(!1)})}),_=async()=>{if(n.imageList.some(t=>t.status==="uploading")){u(s("community.post.waitForUpload"));return}c.value=!0;try{const t={title:n.title,content:n.content,blogGraphVoList:n.imageList.filter(a=>a.status==="done"&&a.url).map(a=>({url:a.url,name:a.file?a.file.name:s("community.post.blogImage")}))};console.log("提交博客数据:",t);const o=await N(t);if(console.log("保存博客响应:",o),o.code===200)u(s("community.post.publishSuccess")),d.back();else throw new Error(o.message||s("community.post.publishFailed"))}catch(t){console.error("发布失败:",t),u(s("community.post.publishFailed"))}finally{c.value=!1}};return(e,t)=>{const o=k,a=I,l=E,b=q,h=S;return D(),$(L,null,[i(o,{title:e.$t("community.post.createPost"),"left-arrow":"",fixed:"",onClickLeft:t[0]||(t[0]=r=>B(d).back())},null,8,["title"]),m("div",T,[m("div",x,[i(h,{onSubmit:_},{default:p(()=>[i(a,{modelValue:n.title,"onUpdate:modelValue":t[1]||(t[1]=r=>n.title=r),name:"title",label:e.$t("community.post.title"),placeholder:e.$t("community.post.titlePlaceholder"),rules:[{required:!0,message:e.$t("community.post.titleRequired")}]},null,8,["modelValue","label","placeholder","rules"]),i(a,{modelValue:n.content,"onUpdate:modelValue":t[2]||(t[2]=r=>n.content=r),name:"content",label:e.$t("community.post.content"),type:"textarea",rows:"4",autosize:"",placeholder:e.$t("community.post.contentPlaceholder"),rules:[{required:!0,message:e.$t("community.post.contentRequired")}]},null,8,["modelValue","label","placeholder","rules"]),m("div",z,[m("div",G,f(e.$t("community.post.addImages")),1),i(l,{modelValue:n.imageList,"onUpdate:modelValue":t[3]||(t[3]=r=>n.imageList=r),multiple:"","max-count":9,"after-read":g,"before-delete":y},null,8,["modelValue"])]),m("div",M,[i(b,{round:"",block:"",type:"primary","native-type":"submit",loading:c.value},{default:p(()=>[P(f(e.$t("community.post.publish")),1)]),_:1},8,["loading"])])]),_:1})])])],64)}}});const ee=A(j,[["__scopeId","data-v-b1867659"]]);export{ee as default};
