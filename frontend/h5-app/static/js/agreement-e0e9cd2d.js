import{d as oe,u as ne,O as se,k as re,r as u,P as D,C as F,o as ue,c as V,w as n,a as M,e as s,t as m,b as o,h as x,j as O,x as j,L as me,a5 as de,B as ie,_ as pe}from"./index-b744bed0.js";import{S as ve}from"./index-c701fe21.js";/* empty css              *//* empty css              */import{d as y,P as ce}from"./dayjs.min-d8b800bc.js";import{C as ye,R as fe}from"./index-10ea773f.js";import{F as ge}from"./index-ede2df1d.js";import{m as Te,n as he,o as be,l as _e,C as $e}from"./index-25c840a0.js";import{d as k,f as G}from"./constEnums-5f5dc902.js";import{I as Ce}from"./index-beccc506.js";const we={class:"page-container min-h-[100vh] py-[15px]"},De={class:"base-info-title main-container py-[4px]"},xe={class:"my-[5px] px-[20px]"},Ie={class:"text-[16px] font-bold mt-[25px] ml-[25px]"},Ve={class:"base-info-title main-container py-[4px]"},Me={class:"my-[5px] px-[20px]"},ke={class:"text-[16px] font-bold mt-[25px] ml-[25px]"},Ne={class:"base-info-title main-container py-[4px]"},Le={class:"main-container my-[5px]"},Se={class:"rounded-xl shadow overflow-hidden"},Ee={class:"base-info-title main-container py-[4px]"},Pe={class:"main-container my-[5px]"},Ye={class:"rounded-xl shadow overflow-hidden"},Re={class:"main-container py-[20px]"},Ue=oe({__name:"agreement",setup(Ae){const{t:p}=ne(),f=se(),I=re(),h=u(f.query.isEdit==="true"),H=u(f.query.isRenew==="true"),N=u(f.query.isAdd==="true"),L=u(f.query.isConfirm==="true"),a=u({id:"",name:"",phone:"",identificationNumber:"",apartmentId:"",roomId:"",leaseStartDate:"",leaseEndDate:"",leaseTermId:"",rent:"",deposit:"",paymentTypeId:"",status:k.WAITING,sourceType:G.NEW,additionalInfo:""}),S=D(()=>{const e=y(a.value.leaseStartDate).isValid()?y(a.value.leaseStartDate).format("YYYY-MM-DD"):"",t=y(a.value.leaseEndDate).isValid()?y(a.value.leaseEndDate).format("YYYY-MM-DD"):"";return`${e} ${p("agreement.leaseStart")} ${t}`}),v=u({text:"",value:""});F(v,e=>{if(e){console.log("newValue",e),a.value.leaseTermId=e.value;try{a.value.leaseTermMonthCount=+e.text.slice(0,-1),isNaN(a.value.leaseTermMonthCount)&&(console.error("租期月数转换错误:",e.text),a.value.leaseTermMonthCount=12)}catch(t){console.error("租期月数解析错误:",t),a.value.leaseTermMonthCount=12}a.value.leaseTermUnit=e.text.slice(-1),y(a.value.leaseStartDate).isValid()?(a.value.leaseEndDate=y(a.value.leaseStartDate).add(a.value.leaseTermMonthCount,"month").format("YYYY-MM-DD"),console.log("租期计算成功:",{开始日期:a.value.leaseStartDate,月数:a.value.leaseTermMonthCount,结束日期:a.value.leaseEndDate})):console.error("开始日期无效:",a.value.leaseStartDate)}},{immediate:!0,deep:!0});const g=u([]),b=u(!1),W=D(()=>g.value.map(e=>({text:e.monthCount+e.unit,value:e.id}))),z=async()=>{const{data:e}=await Te(a.value.roomId);g.value=e},J=e=>{console.log("onConfirmLeaseTerm",e),v.value=e.selectedOptions[0],b.value=!1},_=u([]),c=u({text:"",value:""});F(c,e=>{e&&(console.log("newValue",e),a.value.paymentTypeId=e.value,a.value.paymentTypeName=e.text)},{immediate:!0,deep:!0});const $=u(!1),K=D(()=>_.value.map(e=>({text:`${e.name}`,value:e.id}))),Q=async()=>{const{data:e}=await he(a.value.roomId);_.value=e},X=e=>{console.log("onConfirmPaymentType",e),c.value=e.selectedOptions[0],$.value=!1},E=D(()=>`${a.value.rent}${p("agreement.month")}`),P=D(()=>`${a.value.deposit}${p("agreement.month")}`),Z=async()=>{const{data:e}=await be(f.query.id);a.value=e,v.value.text=e.leaseTermMonthCount+e.leaseTermUnit,v.value.value=e.leaseTermId,c.value.text=e.paymentTypeName,c.value.value=e.paymentTypeId,h.value&&(a.value.leaseStartDate=a.value.leaseEndDate,a.value.leaseEndDate=y(a.value.leaseStartDate).add(a.value.leaseTermMonthCount,"month").format("YYYY-MM-DD"),a.value.status=k.RENEW_TO_BE_CONFIRMED,a.value.sourceType=G.RENEW),N.value&&(a.value.id=""),L.value&&(a.value.status=k.SIGNED)},ee=()=>{let e=g.value.find(r=>r.id===a.value.leaseTermId)||g.value[0];e&&(console.log("targetTerm",e),v.value.text=e.monthCount+e.unit,v.value.value=e.id);let t=_.value.find(r=>r.id===a.value.paymentTypeId)||_.value[0];t&&(console.log("targetPaymentType",t),c.value.text=t.name,c.value.value=t.id)},ae=()=>{I.push({path:"/apartmentDetail",query:{id:a.value.apartmentId}})},te=()=>{I.push({path:"/roomDetail",query:{id:a.value.roomId}})},Y=async()=>{var e,t;console.log(p("agreement.confirmSign"));try{let r=((e=g.value.find(T=>T.id===a.value.leaseTermId))==null?void 0:e.monthCount)||0;console.log(g.value),console.log(a.value),console.log("============================="),console.log(p("agreement.leaseTermLength")+": "+r);let C=((t=_.value.find(T=>T.id===a.value.paymentTypeId))==null?void 0:t.payMonthCount)||0;if(console.log(p("agreement.paymentMonthLength")+": "+C),+r<+C){j({type:"fail",message:p("agreement.termLessThanPayment")});return}await _e(a.value),j({type:"success",message:p("common.success")}),I.back()}catch(r){console.log(r)}};return ue(async()=>{f.query.id&&await Z(),await z(),await Q(),h.value&&ee()}),(e,t)=>{var q;const r=me,C=Ce,T=$e,d=ge,i=ye,R=fe,U=ce,A=de,B=ie,le=ve;return M(),V(le,{row:20,loading:!((q=a.value)!=null&&q.roomId)},{default:n(()=>[s("div",we,[s("div",null,[s("div",De,m(e.$t("agreement.signedApartment")),1),s("div",xe,[o(T,{onClick:t[0]||(t[0]=l=>ae()),class:"rounded-xl shadow"},{title:n(()=>[s("h2",Ie,m(`${a.value.apartmentName}`),1)]),thumb:n(()=>{var l,w;return[o(C,{class:"w-full h-full object-cover",src:((w=(l=a.value.apartmentGraphVoList)==null?void 0:l[0])==null?void 0:w.url)||e.$t("common.loadFailed")},{error:n(()=>[x(m(e.$t("common.loadFailed")),1)]),loading:n(()=>[o(r,{type:"spinner",size:"20"})]),_:1},8,["src"])]}),_:1})])]),s("div",null,[s("div",Ve,m(e.$t("agreement.signedRoom")),1),s("div",Me,[o(T,{onClick:t[1]||(t[1]=l=>te()),class:"rounded-xl shadow"},{title:n(()=>[s("h2",ke,m(`${a.value.roomNumber}${e.$t("agreement.room")}`),1)]),thumb:n(()=>{var l,w;return[o(C,{class:"w-full h-full object-cover",src:((w=(l=a.value.roomGraphVoList)==null?void 0:l[0])==null?void 0:w.url)||e.$t("common.loadFailed")},{error:n(()=>[x(m(e.$t("common.loadFailed")),1)]),loading:n(()=>[o(r,{type:"spinner",size:"20"})]),_:1},8,["src"])]}),_:1})])]),s("div",null,[s("div",Ne,m(e.$t("agreement.tenantInfo")),1),s("div",Le,[s("div",Se,[o(R,null,{default:n(()=>[o(i,{span:"24"},{default:n(()=>[o(d,{readonly:"","label-width":"70px",label:e.$t("agreement.name"),modelValue:a.value.name,"onUpdate:modelValue":t[2]||(t[2]=l=>a.value.name=l)},null,8,["label","modelValue"])]),_:1}),o(i,{span:"24"},{default:n(()=>[o(d,{readonly:"","label-width":"70px",label:e.$t("agreement.phone"),modelValue:a.value.phone,"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.phone=l)},null,8,["label","modelValue"])]),_:1}),o(i,{span:"24"},{default:n(()=>[o(d,{readonly:"","label-width":"70px",label:e.$t("agreement.idNumber"),modelValue:a.value.identificationNumber,"onUpdate:modelValue":t[4]||(t[4]=l=>a.value.identificationNumber=l)},null,8,["label","modelValue"])]),_:1})]),_:1})])])]),s("div",null,[s("div",Ee,m(e.$t("agreement.leaseDetails")),1),s("div",Pe,[s("div",Ye,[o(R,null,{default:n(()=>[o(i,{span:"24"},{default:n(()=>[o(d,{modelValue:v.value.text,"onUpdate:modelValue":t[5]||(t[5]=l=>v.value.text=l),"is-link":"",readonly:"",name:"picker","label-width":"70px",label:e.$t("agreement.leaseTerm"),placeholder:e.$t("agreement.selectLeaseTerm"),onClick:t[6]||(t[6]=l=>h.value&&(b.value=!0))},null,8,["modelValue","label","placeholder"]),o(A,{show:b.value,"onUpdate:show":t[8]||(t[8]=l=>b.value=l),position:"bottom"},{default:n(()=>[o(U,{title:e.$t("agreement.leaseTerm"),columns:W.value,onConfirm:J,onCancel:t[7]||(t[7]=l=>b.value=!1)},null,8,["title","columns"])]),_:1},8,["show"])]),_:1}),o(i,{span:"24"},{default:n(()=>[o(d,{readonly:"","label-width":"70px",label:e.$t("agreement.contractPeriod"),modelValue:S.value,"onUpdate:modelValue":t[9]||(t[9]=l=>S.value=l)},null,8,["label","modelValue"])]),_:1}),o(i,{span:"24"},{default:n(()=>[o(d,{readonly:"","label-width":"70px",label:e.$t("agreement.idNumber"),modelValue:a.value.identificationNumber,"onUpdate:modelValue":t[10]||(t[10]=l=>a.value.identificationNumber=l)},null,8,["label","modelValue"])]),_:1}),o(i,{span:"24"},{default:n(()=>[o(d,{readonly:"","label-width":"70px",label:e.$t("agreement.rent"),modelValue:E.value,"onUpdate:modelValue":t[11]||(t[11]=l=>E.value=l)},null,8,["label","modelValue"])]),_:1}),o(i,{span:"24"},{default:n(()=>[o(d,{readonly:"","label-width":"70px",label:e.$t("agreement.deposit"),modelValue:P.value,"onUpdate:modelValue":t[12]||(t[12]=l=>P.value=l)},null,8,["label","modelValue"])]),_:1}),o(i,{span:"24"},{default:n(()=>[o(d,{modelValue:c.value.text,"onUpdate:modelValue":t[13]||(t[13]=l=>c.value.text=l),"is-link":"",readonly:"",name:"picker","label-width":"70px",label:e.$t("agreement.paymentMethod"),placeholder:e.$t("agreement.selectPaymentMethod"),onClick:t[14]||(t[14]=l=>h.value&&($.value=!0))},null,8,["modelValue","label","placeholder"]),o(A,{show:$.value,"onUpdate:show":t[16]||(t[16]=l=>$.value=l),position:"bottom"},{default:n(()=>[o(U,{title:e.$t("agreement.paymentMethod"),columns:K.value,onConfirm:X,onCancel:t[15]||(t[15]=l=>$.value=!1)},null,8,["title","columns"])]),_:1},8,["show"])]),_:1})]),_:1})])])]),s("div",Re,[h.value&&H.value?(M(),V(B,{key:0,type:"primary",block:"",round:"",class:"m-t-20",onClick:Y},{default:n(()=>[x(m(N.value?e.$t("agreement.confirmRenew"):e.$t("common.save")),1)]),_:1})):O("",!0),L.value?(M(),V(B,{key:1,type:"primary",block:"",round:"",class:"m-t-20",onClick:Y},{default:n(()=>[x(m(e.$t("agreement.confirmSign")),1)]),_:1})):O("",!0)])])]),_:1},8,["loading"])}}});const Ke=pe(Ue,[["__scopeId","data-v-0b388ed3"]]);export{Ke as default};
