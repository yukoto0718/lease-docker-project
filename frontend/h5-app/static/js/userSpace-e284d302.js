import{d as L,u as A,O as H,k as Y,P as C,r as _,C as G,A as J,o as K,f as i,b as m,s as D,e as a,t as c,w as I,j as b,x as g,av as Q,B as W,q as X,a as n,h as F,F as U,g as B,c as Z,v as ee,m as se,I as te,_ as oe}from"./index-b744bed0.js";import{E as ae}from"./index-479e4c76.js";import{S as ne}from"./index-c701fe21.js";import{P as le}from"./PullDownRefreshContainer-eb4714b8.js";import{i as ie,j as re,u as ce,f as ue}from"./index-58f473f0.js";import{g as de}from"./auth-22cde164.js";import{u as me}from"./useLike-4f904da7.js";import"./index-ae057aef.js";const pe={class:"user-space bg-[--color-block-background] min-h-screen pb-[80px]"},ve={class:"user-info-container bg-[#5a8eef] text-white p-[15px] mx-[15px] mt-[15px] rounded-[8px]"},fe={class:"text-[20px] font-bold"},_e={key:0,class:"mt-[10px]"},ge={key:0,class:"mt-[15px]"},he={key:1,class:"flex flex-col items-center justify-center py-[30px]"},ye={key:2,class:"blog-list"},ke=["onClick"],we={class:"bg-[--color-background-3] main-container py-[10px] relative"},xe={class:"mt-[10px] flex flex-col"},Se={class:"font-bold"},Ce={class:"van-multi-ellipsis--l3"},Ie={class:"flex mt-[10px]"},Fe=["onClick"],$e={class:"ml-[5px]"},De={class:"flex items-center ml-[20px]"},be={class:"ml-[5px]"},Ue={class:"text-[12px] text-[--van-gray-6] ml-auto"},Be=L({name:"UserSpace"}),Le=L({...Be,setup(Re){const{t:u}=A(),y=H(),k=Y(),w=C(()=>y.params.userId),{handleLike:R,initLikeStatus:T}=me(),x=_(!1),r=_([]),s=_({userId:"",nickname:"",isOwnSpace:!1,isFollowing:!1}),h=_(),P=C(()=>u("community.post.userSpace")),j=C(()=>s.value.isOwnSpace?u("userSpace.mySpace"):u("userSpace.userSpace",{nickname:s.value.nickname||u("community.user")+s.value.userId})),d=_(!1),$=async()=>{try{const e=await ie(w.value);if(d.value)return;e.code===200&&e.data?s.value=e.data:d.value||g("获取用户信息失败")}catch(e){if(d.value)return;console.error("获取用户空间信息错误:",e),g("获取用户信息失败")}},N=async e=>{var t;console.log("加载用户博客列表，用户ID:",w.value,"分页参数:",e),x.value=e.current===1;try{const l=await re(w.value,e);if(d.value)return!1;if(console.log("API响应:",l),l.code===200&&l.data){const f=l.data.records||[];if(e.current===1)r.value=f;else{const p=new Set(r.value.map(v=>v.id)),S=f.filter(v=>!p.has(v.id));r.value=[...r.value,...S]}return r.value.forEach(p=>{p.isLiked&&T(p.id,!0)}),(t=h.value)==null||t.setFinished(r.value.length>=(l.data.total||0)),!0}else return!1}catch(l){return d.value||console.error("获取用户博客列表错误:",l),!1}finally{d.value||(x.value=!1)}},O=async()=>{try{const e=s.value.isFollowing;s.value.isFollowing=!e,e?(await ce(s.value.userId),g(u("community.post.unfollowSuccess"))):(await ue(s.value.userId),g(u("community.post.followSuccess")))}catch(e){console.error("关注操作错误:",e),s.value.isFollowing=!s.value.isFollowing,g(u("community.operationFailed"))}},z=e=>{k.push(`/blog/detail/${e}`)},E=()=>{k.push({name:"CreatePost"})},M=e=>{if(!e)return"";const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`};return G(()=>y.params.userId,(e,t)=>{console.log(`用户ID变化: ${t} -> ${e}`),e&&e!=="undefined"?($(),h.value&&h.value.onRefresh()):console.log("路由参数为空，不加载数据")},{immediate:!0}),J(()=>{console.log("UserSpace组件即将卸载"),d.value=!0}),K(async()=>{var e;console.log("UserSpace组件已挂载"),console.log("URL参数中的用户ID:",y.params.userId),console.log("当前登录用户ID:",(e=de())==null?void 0:e.userId),await $()}),(e,t)=>{const l=Q,f=W,p=ne,S=ae,v=te,V=X("on-click-remove-class");return n(),i("div",pe,[m(l,{title:P.value,"left-arrow":"",onClickLeft:t[0]||(t[0]=o=>D(k).back())},null,8,["title"]),a("div",ve,[a("div",fe,c(j.value),1),s.value.isOwnSpace?b("",!0):(n(),i("div",_e,[m(f,{round:"",size:"small",type:s.value.isFollowing?"default":"primary",plain:!s.value.isFollowing,onClick:O},{default:I(()=>[F(c(s.value.isFollowing?e.$t("community.post.followed"):e.$t("community.post.follow")),1)]),_:1},8,["type","plain"])]))]),m(le,{request:N,ref_key:"pullDownRefreshContainerRef",ref:h,class:"min-h-[70vh]"},{default:I(()=>[x.value?(n(),i("div",ge,[(n(),i(U,null,B(3,o=>a("div",{key:o,class:"bg-[--color-background-3] main-container py-[10px] mb-[15px]"},[m(p,{title:"",row:3})])),64))])):r.value.length===0?(n(),i("div",he,[m(S,{description:e.$t("community.noBlogContent")},null,8,["description"]),s.value.isOwnSpace?(n(),Z(f,{key:0,type:"primary",size:"small",class:"mt-[15px]",onClick:E},{default:I(()=>[F(c(e.$t("community.publish")),1)]),_:1})):b("",!0)])):(n(),i("div",ye,[(n(!0),i(U,null,B(r.value,o=>(n(),i("div",{key:o.id,class:"mt-[15px] blog-item",onClick:q=>z(o.id)},[a("div",we,[a("div",xe,[a("div",Se,c(o.title),1),ee((n(),i("div",Ce,[F(c(o.content),1)])),[[V,["van-multi-ellipsis--l3"]]]),a("div",Ie,[a("div",{class:"flex items-center",onClick:se(q=>D(R)(o),["stop"])},[m(v,{name:o.isLiked?"good-job":"good-job-o",color:o.isLiked?"#ff5000":"",size:"20"},null,8,["name","color"]),a("div",$e,c(o.liked||0),1)],8,Fe),a("div",De,[m(v,{name:"comment-o",size:"20"}),a("div",be,c(o.comments||0),1)]),a("div",Ue,c(M(o.createTime)),1)])])])],8,ke))),128))]))]),_:1},512)])}}});const Ve=oe(Le,[["__scopeId","data-v-c69def54"]]);export{Ve as default};
