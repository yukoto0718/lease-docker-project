import{J as h}from"./index-b744bed0.js";function m(n){try{const a=n.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(atob(a).split("").map(u=>"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)).join("")),t=JSON.parse(s);return console.log("【调试-auth】从JWT令牌解析出payload:",t),t}catch(r){return console.error("【调试-auth】解析JWT令牌失败:",r),null}}function i(n){try{const r=m(n);return r&&r.userId?(console.log("【调试-auth】从JWT令牌中提取到用户ID:",r.userId),r.userId):null}catch(r){return console.error("【调试-auth】从JWT令牌中提取用户ID失败:",r),null}}function U(){var n,r,a,s,t,u,d,f;try{const e=h();if(console.log("【调试-auth】从Pinia Store获取用户信息:",e),e.userId)return console.log("【调试-auth】从Store获取的用户ID:",e.userId),{userId:e.userId,nickname:((n=e.userInfo)==null?void 0:n.nickname)||void 0,avatar:((r=e.userInfo)==null?void 0:r.avatarUrl)||void 0};if(e.userInfo&&e.userInfo.userId)return console.log("【调试-auth】从userInfo获取的用户ID:",e.userInfo.userId),{userId:e.userInfo.userId,nickname:e.userInfo.nickname||void 0,avatar:e.userInfo.avatarUrl||void 0};const l=e.token;if(l){console.log("【调试-auth】从Store中找到token，尝试解析:",l.substring(0,20)+"...");const o=i(l);if(o)return console.log("【调试-auth】成功从token中解析出用户ID:",o),{userId:o,nickname:((a=e.userInfo)==null?void 0:a.nickname)||void 0,avatar:((s=e.userInfo)==null?void 0:s.avatarUrl)||void 0}}const c=localStorage.getItem("app-user");if(console.log("【调试-auth】尝试从localStorage获取用户信息:",c),c){const o=JSON.parse(c);if(console.log("【调试-auth】解析后的本地用户信息:",o),o.userId)return{userId:o.userId,nickname:((t=o.userInfo)==null?void 0:t.nickname)||void 0,avatar:((u=o.userInfo)==null?void 0:u.avatarUrl)||void 0};if(o.userInfo&&o.userInfo.userId)return{userId:o.userInfo.userId,nickname:o.userInfo.nickname||void 0,avatar:o.userInfo.avatarUrl||void 0};if(o.token){console.log("【调试-auth】从localStorage中找到token，尝试解析");const I=i(o.token);if(I)return console.log("【调试-auth】成功从localStorage的token中解析出用户ID:",I),{userId:I,nickname:((d=o.userInfo)==null?void 0:d.nickname)||void 0,avatar:((f=o.userInfo)==null?void 0:f.avatarUrl)||void 0}}}const g=localStorage.getItem("token"),v=sessionStorage.getItem("token"),k=g||v;if(k){console.log("【调试-auth】尝试从本地存储的token中解析用户ID");const o=i(k);if(o)return console.log("【调试-auth】成功从本地存储的token中解析出用户ID:",o),{userId:o,nickname:void 0,avatar:void 0};console.log("【调试-auth】找到token但无法解析出用户ID")}return console.warn("【调试-auth】无法获取有效的用户信息"),null}catch(e){return console.error("【调试-auth】获取用户信息时出错:",e),null}}export{U as g};
