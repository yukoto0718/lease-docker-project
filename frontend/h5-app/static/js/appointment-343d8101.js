import{U as F,V as Q,X as N,Y as ee,Z as j,$ as O,d as U,r as T,P as Y,C as A,a0 as P,a1 as E,b as f,T as G,a2 as Z,a3 as z,a4 as b,O as te,k as ae,o as ne,c as oe,w as C,a as le,e as $,t as q,h as ie,x as me,a5 as ue,B as re,_ as se}from"./index-b744bed0.js";import{S as de}from"./index-c701fe21.js";import{C as ce}from"./index-bd70418e.js";/* empty css              *//* empty css              */import{p as K,P as L,d as w}from"./dayjs.min-d8b800bc.js";import{F as pe}from"./index-ede2df1d.js";import{f as fe,i as ve,s as ge}from"./index-25c840a0.js";import{_ as he}from"./ApartmentCard.vue_vue_type_script_setup_true_lang-c341dbcb.js";import{A as ye}from"./constEnums-5f5dc902.js";import{F as Ve}from"./index-6f272d29.js";import"./index-beccc506.js";const W=F({},K,{modelValue:Q(),filter:Function,formatter:{type:Function,default:(e,m)=>m}}),X=Object.keys(K);function De(e,m){if(e<0)return[];const c=Array(e);let o=-1;for(;++o<e;)c[o]=m(o);return c}const Te=(e,m)=>32-new Date(e,m-1,32).getDate(),M=(e,m,c,o,d,l)=>{const s=De(m-e+1,v=>{const V=N(e+v);return o(c,{text:V,value:V})});return d?d(c,s,l):s},J=(e,m)=>e.map((c,o)=>{const d=m[o];if(d.length){const l=+d[0].value,s=+d[d.length-1].value;return N(ee(+c,l,s))}return c}),B=new Date().getFullYear(),[$e]=j("date-picker"),ke=F({},W,{columnsType:{type:Array,default:()=>["year","month","day"]},minDate:{type:Date,default:()=>new Date(B-10,0,1),validator:O},maxDate:{type:Date,default:()=>new Date(B+10,11,31),validator:O}});var xe=U({name:$e,props:ke,emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:m,slots:c}){const o=T(e.modelValue),d=T(!1),l=T(),s=Y(()=>d.value?e.modelValue:o.value),v=t=>t===e.minDate.getFullYear(),V=t=>t===e.maxDate.getFullYear(),k=t=>t===e.minDate.getMonth()+1,I=t=>t===e.maxDate.getMonth()+1,S=t=>{const{minDate:r,columnsType:p}=e,u=p.indexOf(t),H=s.value[u];if(H)return+H;switch(t){case"year":return r.getFullYear();case"month":return r.getMonth()+1;case"day":return r.getDate()}},i=()=>{const t=e.minDate.getFullYear(),r=e.maxDate.getFullYear();return M(t,r,"year",e.formatter,e.filter,s.value)},a=()=>{const t=S("year"),r=v(t)?e.minDate.getMonth()+1:1,p=V(t)?e.maxDate.getMonth()+1:12;return M(r,p,"month",e.formatter,e.filter,s.value)},n=()=>{const t=S("year"),r=S("month"),p=v(t)&&k(r)?e.minDate.getDate():1,u=V(t)&&I(r)?e.maxDate.getDate():Te(t,r);return M(p,u,"day",e.formatter,e.filter,s.value)},g=()=>{var t;return(t=l.value)==null?void 0:t.confirm()},_=()=>o.value,x=Y(()=>e.columnsType.map(t=>{switch(t){case"year":return i();case"month":return a();case"day":return n();default:return[]}}));A(o,t=>{P(t,e.modelValue)||m("update:modelValue",t)}),A(()=>e.modelValue,(t,r)=>{d.value=P(r,o.value),t=J(t,x.value),P(t,o.value)||(o.value=t),d.value=!1},{immediate:!0});const y=(...t)=>m("change",...t),h=(...t)=>m("cancel",...t),D=(...t)=>m("confirm",...t);return E({confirm:g,getSelectedDate:_}),()=>f(L,G({ref:l,modelValue:o.value,"onUpdate:modelValue":t=>o.value=t,columns:x.value,onChange:y,onCancel:h,onConfirm:D},Z(e,X)),c)}});const Se=z(xe),[_e]=j("time-picker"),R=e=>/^([01]\d|2[0-3]):([0-5]\d):([0-5]\d)$/.test(e),be=["hour","minute","second"],Ce=F({},W,{minHour:b(0),maxHour:b(23),minMinute:b(0),maxMinute:b(59),minSecond:b(0),maxSecond:b(59),minTime:{type:String,validator:R},maxTime:{type:String,validator:R},columnsType:{type:Array,default:()=>["hour","minute"]}});var we=U({name:_e,props:Ce,emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:m,slots:c}){const o=T(e.modelValue),d=T(),l=i=>{const a=i.split(":");return be.map((n,g)=>e.columnsType.includes(n)?a[g]:"00")},s=()=>{var i;return(i=d.value)==null?void 0:i.confirm()},v=()=>o.value,V=Y(()=>{let{minHour:i,maxHour:a,minMinute:n,maxMinute:g,minSecond:_,maxSecond:x}=e;if(e.minTime||e.maxTime){const y={hour:0,minute:0,second:0};e.columnsType.forEach((t,r)=>{var p;y[t]=(p=o.value[r])!=null?p:0});const{hour:h,minute:D}=y;if(e.minTime){const[t,r,p]=l(e.minTime);i=t,n=+h<=+i?r:"00",_=+h<=+i&&+D<=+n?p:"00"}if(e.maxTime){const[t,r,p]=l(e.maxTime);a=t,g=+h>=+a?r:"59",x=+h>=+a&&+D>=+g?p:"59"}}return e.columnsType.map(y=>{const{filter:h,formatter:D}=e;switch(y){case"hour":return M(+i,+a,y,D,h,o.value);case"minute":return M(+n,+g,y,D,h,o.value);case"second":return M(+_,+x,y,D,h,o.value);default:return[]}})});A(o,i=>{P(i,e.modelValue)||m("update:modelValue",i)}),A(()=>e.modelValue,i=>{i=J(i,V.value),P(i,o.value)||(o.value=i)},{immediate:!0});const k=(...i)=>m("change",...i),I=(...i)=>m("cancel",...i),S=(...i)=>m("confirm",...i);return E({confirm:s,getSelectedTime:v}),()=>f(L,G({ref:d,modelValue:o.value,"onUpdate:modelValue":i=>o.value=i,columns:V.value,onChange:k,onCancel:I,onConfirm:S},Z(e,X)),c)}});const Me=z(we),Ie={class:"page-container min-h-[100vh] py-[15px]"},Pe={class:"base-info-title main-container py-[4px]"},Ae={class:"my-[5px] px-[15px]"},qe={class:"base-info-title main-container py-[4px]"},Ye={class:"my-[5px] relative"},Fe={class:"mt-[50px] main-container"},Ue=U({__name:"appointment",setup(e){const m=te(),c=ae(),o=T({}),d=async()=>{const{data:a}=await fe(m.query.apartmentId);o.value=a},l=T({id:"",name:"",phone:"",apartmentId:m.query.apartmentId||"",appointmentTime:"",additionalInfo:"",appointmentStatus:ye.WAITING,date:"",time:""}),s=T({date:[w().get("year").toString(),(w().get("month")+1).toString().padStart(2,"0"),w().get("date").toString().padStart(2,"0")],time:[w().get("hour").toString().padStart(2,"0"),w().get("minute").toString().padStart(2,"0"),w().get("second").toString().padStart(2,"0")]});A(s,(a,n)=>{console.log("newVal",a),console.log("oldVal",n),l.value.date=a.date.join("-"),l.value.time=`${a.time.join(":")}`,l.value.appointmentTime=`${l.value.date} ${l.value.time}`},{immediate:!0,deep:!0});const v=T(!1),V=a=>{console.log("date",a),s.value.date=a.selectedValues,v.value=!1},k=T(!1),I=a=>{console.log("date",a),k.value=!1};async function S(a){console.log("submit",a),await ge(l.value),me("操作成功"),m.query.apartmentId?await c.replace("/myAppointment"):await c.back()}async function i(){const{data:a}=await ve(m.query.appointmentId);Object.keys(l.value).forEach(n=>{l.value[n]=a[n]}),s.value.date=a.appointmentTime.split(" ")[0].split("-"),s.value.time=a.appointmentTime.split(" ")[1].split(":"),o.value=a.apartmentItemVo}return ne(async()=>{m.query.apartmentId&&await d(),m.query.appointmentId&&await i()}),(a,n)=>{var p;const g=pe,_=Se,x=ue,y=Me,h=ce,D=re,t=Ve,r=de;return le(),oe(r,{row:20,loading:!((p=o.value)!=null&&p.id)},{default:C(()=>[$("div",Ie,[$("div",null,[$("div",Pe,q(a.$t("appointment.appointmentApartment")),1),$("div",Ae,[f(he,{data:o.value},null,8,["data"])])]),$("div",null,[$("div",qe,q(a.$t("appointment.appointmentInfo")),1),$("div",Ye,[f(t,{onSubmit:S},{default:C(()=>[f(h,{inset:""},{default:C(()=>[f(g,{modelValue:l.value.name,"onUpdate:modelValue":n[0]||(n[0]=u=>l.value.name=u),modelModifiers:{trim:!0},name:"name",label:a.$t("appointment.name"),autocomplete:"off",placeholder:a.$t("appointment.namePlaceholder"),rules:[{required:!0,message:a.$t("appointment.nameRequired")}]},null,8,["modelValue","label","placeholder","rules"]),f(g,{modelValue:l.value.phone,"onUpdate:modelValue":n[1]||(n[1]=u=>l.value.phone=u),modelModifiers:{trim:!0},name:"phone",label:a.$t("appointment.phone"),type:"tel",autocomplete:"off",placeholder:a.$t("appointment.phonePlaceholder"),rules:[{required:!0,pattern:/^1([3589]\d|4[5-9]|6[1-2,4-7]|7[0-8])\d{8}$/,message:a.$t("appointment.phoneInvalid")}]},null,8,["modelValue","label","placeholder","rules"]),f(g,{modelValue:l.value.date,"onUpdate:modelValue":n[2]||(n[2]=u=>l.value.date=u),"is-link":"",readonly:"",name:"date",label:a.$t("appointment.date"),placeholder:a.$t("appointment.datePlaceholder"),onClick:n[3]||(n[3]=u=>v.value=!0),rules:[{required:!0,message:a.$t("appointment.dateRequired")}]},null,8,["modelValue","label","placeholder","rules"]),f(x,{show:v.value,"onUpdate:show":n[5]||(n[5]=u=>v.value=u),position:"bottom"},{default:C(()=>[f(_,{"min-date":new Date,onConfirm:V,onCancel:n[4]||(n[4]=u=>v.value=!1)},null,8,["min-date"])]),_:1},8,["show"]),f(g,{modelValue:l.value.time,"onUpdate:modelValue":n[6]||(n[6]=u=>l.value.time=u),"is-link":"",readonly:"",name:"time",label:a.$t("appointment.appointmentTime"),placeholder:a.$t("appointment.timePlaceholder"),onClick:n[7]||(n[7]=u=>k.value=!0),rules:[{required:!0,message:a.$t("appointment.timeRequired")}]},null,8,["modelValue","label","placeholder","rules"]),f(x,{show:k.value,"onUpdate:show":n[10]||(n[10]=u=>k.value=u),position:"bottom"},{default:C(()=>[f(y,{modelValue:s.value.time,"onUpdate:modelValue":n[8]||(n[8]=u=>s.value.time=u),title:a.$t("appointment.selectTime"),onConfirm:I,onCancel:n[9]||(n[9]=u=>v.value=!1),"columns-type":["hour","minute","second"]},null,8,["modelValue","title"])]),_:1},8,["show"]),f(g,{modelValue:l.value.additionalInfo,"onUpdate:modelValue":n[11]||(n[11]=u=>l.value.additionalInfo=u),modelModifiers:{trim:!0},name:"additionalInfo",label:a.$t("appointment.remark"),rows:"3",autosize:"",type:"textarea",autocomplete:"off",placeholder:a.$t("appointment.remarkPlaceholder"),"show-word-limit":"",maxlength:"50"},null,8,["modelValue","label","placeholder"])]),_:1}),$("div",Fe,[f(D,{round:"",block:"",type:"primary","native-type":"submit"},{default:C(()=>[ie(q(l.value.id?a.$t("appointment.reschedule"):a.$t("apartment.appointmentView")),1)]),_:1})])]),_:1})])]),n[12]||(n[12]=$("div",{class:"absolute bottom-0"},null,-1))])]),_:1},8,["loading"])}}});const We=se(Ue,[["__scopeId","data-v-baf6f91e"]]);export{We as default};
