import{Z as p,d as ee,au as oe,ae as re,r as R,P as D,C as z,ag as me,a1 as ae,b as u,ad as E,aa as q,ah as $,Y as b,aF as ve,L as ue,aG as te,aH as ge,a9 as x,V as de,a4 as B,aI as G,a8 as K,o as fe,aJ as he,aK as we,ak as Ce,T as ie,a2 as Ie,a5 as Pe,ai as Se,I as ye,aA as be,aL as xe,U as Te,aM as ke,aN as Oe}from"./index-b744bed0.js";import{S as Ye,a as Ze}from"./index-515de819.js";import{I as Xe}from"./index-beccc506.js";const J=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),Re=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),A=p("image-preview")[1],Q=2.6,ze={src:String,show:Boolean,active:Number,minZoom:E(q),maxZoom:E(q),rootWidth:E(Number),rootHeight:E(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean};var Me=ee({props:ze,emits:["scale","close","longPress"],setup(e,{emit:c,slots:g}){const o=oe({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),r=re(),l=R(),I=R(),T=R(!1),d=R(!1);let k=0;const O=D(()=>{const{scale:a,moveX:t,moveY:i,moving:n,zooming:v,initializing:C}=o,H={transitionDuration:v||n||C?"0s":".3s"};return(a!==1||d.value)&&(H.transform=`matrix(${a}, 0, 0, ${a}, ${t}, ${i})`),H}),f=D(()=>{if(o.imageRatio){const{rootWidth:a,rootHeight:t}=e,i=T.value?t/o.imageRatio:a;return Math.max(0,(o.scale*i-a)/2)}return 0}),h=D(()=>{if(o.imageRatio){const{rootWidth:a,rootHeight:t}=e,i=T.value?t:a*o.imageRatio;return Math.max(0,(o.scale*i-t)/2)}return 0}),Y=(a,t)=>{var i;if(a=b(a,+e.minZoom,+e.maxZoom+1),a!==o.scale){const n=a/o.scale;if(o.scale=a,t){const v=te((i=l.value)==null?void 0:i.$el),C={x:v.width*.5,y:v.height*.5},H=o.moveX-(t.x-v.left-C.x)*(n-1),ce=o.moveY-(t.y-v.top-C.y)*(n-1);o.moveX=b(H,-f.value,f.value),o.moveY=b(ce,-h.value,h.value)}else o.moveX=0,o.moveY=d.value?k:0;c("scale",{scale:a,index:e.active})}},P=()=>{Y(1)},W=()=>{const a=o.scale>1?1:2;Y(a,a===2||d.value?{x:r.startX.value,y:r.startY.value}:void 0)};let S,Z,y,s,w,m,M,L,_=!1;const se=a=>{const{touches:t}=a;if(S=t.length,S===2&&e.disableZoom)return;const{offsetX:i}=r;r.start(a),Z=o.moveX,y=o.moveY,L=Date.now(),_=!1,o.moving=S===1&&(o.scale!==1||d.value),o.zooming=S===2&&!i.value,o.zooming&&(s=o.scale,w=J(t))},le=a=>{const{touches:t}=a;if(r.move(a),o.moving){const{deltaX:i,deltaY:n}=r,v=i.value+Z,C=n.value+y;if((e.vertical?r.isVertical()&&Math.abs(C)>h.value:r.isHorizontal()&&Math.abs(v)>f.value)&&!_){o.moving=!1;return}_=!0,$(a,!0),o.moveX=b(v,-f.value,f.value),o.moveY=b(C,-h.value,h.value)}if(o.zooming&&($(a,!0),t.length===2)){const i=J(t),n=s*i/w;m=Re(t),Y(n,m)}},F=a=>{var t;const i=(t=I.value)==null?void 0:t.$el;if(!i)return;const n=i.firstElementChild,v=a.target===i,C=n==null?void 0:n.contains(a.target);!e.closeOnClickImage&&C||!e.closeOnClickOverlay&&v||c("close")},ne=a=>{if(S>1)return;const t=Date.now()-L,i=250;r.isTap.value&&(t<i?e.doubleScale?M?(clearTimeout(M),M=null,W()):M=setTimeout(()=>{F(a),M=null},i):F(a):t>ge&&c("longPress"))},U=a=>{let t=!1;if((o.moving||o.zooming)&&(t=!0,o.moving&&Z===o.moveX&&y===o.moveY&&(t=!1),!a.touches.length)){o.zooming&&(o.moveX=b(o.moveX,-f.value,f.value),o.moveY=b(o.moveY,-h.value,h.value),o.zooming=!1),o.moving=!1,Z=0,y=0,s=1,o.scale<1&&P();const i=+e.maxZoom;o.scale>i&&Y(i,m)}$(a,t),ne(a),r.reset()},V=()=>{const{rootWidth:a,rootHeight:t}=e,i=t/a,{imageRatio:n}=o;T.value=o.imageRatio>i&&n<Q,d.value=o.imageRatio>i&&n>=Q,d.value&&(k=(n*a-t)/2,o.moveY=k,o.initializing=!0,ve(()=>{o.initializing=!1})),P()},j=a=>{const{naturalWidth:t,naturalHeight:i}=a.target;o.imageRatio=i/t,V()};return z(()=>e.active,P),z(()=>e.show,a=>{a||P()}),z(()=>[e.rootWidth,e.rootHeight],V),me("touchmove",le,{target:D(()=>{var a;return(a=I.value)==null?void 0:a.$el})}),ae({resetScale:P}),()=>{const a={loading:()=>u(ue,{type:"spinner"},null)};return u(Ye,{ref:I,class:A("swipe-item"),onTouchstartPassive:se,onTouchend:U,onTouchcancel:U},{default:()=>[g.image?u("div",{class:A("image-wrap")},[g.image({src:e.src,onLoad:j,style:O.value})]):u(Xe,{ref:l,src:e.src,fit:"contain",class:A("image",{vertical:T.value}),style:O.value,onLoad:j},a)]})}}});const[He,X]=p("image-preview"),De=["show","teleport","transition","overlayStyle","closeOnPopstate"],Ee={show:Boolean,loop:x,images:de(),minZoom:B(1/3),maxZoom:B(3),overlay:x,vertical:Boolean,closeable:Boolean,showIndex:x,className:G,closeIcon:K("clear"),transition:String,beforeClose:Function,doubleScale:x,overlayClass:G,overlayStyle:Object,swipeDuration:B(300),startPosition:B(0),showIndicators:Boolean,closeOnPopstate:x,closeOnClickImage:x,closeOnClickOverlay:x,closeIconPosition:K("top-right"),teleport:[String,Object]};var Be=ee({name:He,props:Ee,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:c,slots:g}){const o=R(),r=R(),l=oe({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),I=()=>{if(o.value){const s=te(o.value.$el);l.rootWidth=s.width,l.rootHeight=s.height,o.value.resize()}},T=s=>c("scale",s),d=s=>c("update:show",s),k=()=>{be(e.beforeClose,{args:[l.active],done:()=>d(!1)})},O=s=>{s!==l.active&&(l.active=s,c("change",s))},f=()=>{if(e.showIndex)return u("div",{class:X("index")},[g.index?g.index({index:l.active}):`${l.active+1} / ${e.images.length}`])},h=()=>{if(g.cover)return u("div",{class:X("cover")},[g.cover()])},Y=()=>{l.disableZoom=!0},P=()=>{l.disableZoom=!1},W=()=>u(Ze,{ref:o,lazyRender:!0,loop:e.loop,class:X("swipe"),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:O,onDragEnd:P,onDragStart:Y},{default:()=>[e.images.map((s,w)=>u(Me,{ref:m=>{w===l.active&&(r.value=m)},src:s,show:e.show,active:l.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:l.rootWidth,rootHeight:l.rootHeight,disableZoom:l.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:T,onClose:k,onLongPress:()=>c("longPress",{index:w})},{image:g.image}))]}),S=()=>{if(e.closeable)return u(ye,{role:"button",name:e.closeIcon,class:[X("close-icon",e.closeIconPosition),Se],onClick:k},null)},Z=()=>c("closed"),y=(s,w)=>{var m;return(m=o.value)==null?void 0:m.swipeTo(s,w)};return ae({resetScale:()=>{var s;(s=r.value)==null||s.resetScale()},swipeTo:y}),fe(I),z([he,we],I),z(()=>e.startPosition,s=>O(+s)),z(()=>e.show,s=>{const{images:w,startPosition:m}=e;s?(O(+m),Ce(()=>{I(),y(+m,{immediate:!0})})):c("close",{index:l.active,url:w[l.active]})}),()=>u(Pe,ie({class:[X(),e.className],overlayClass:[X("overlay"),e.overlayClass],onClosed:Z,"onUpdate:show":d},Ie(e,De)),{default:()=>[S(),W(),f(),h()]})}});let N;const Ne={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,vertical:!1,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function We(){({instance:N}=ke({setup(){const{state:e,toggle:c}=Oe(),g=()=>{e.images=[]};return()=>u(Be,ie(e,{onClosed:g,"onUpdate:show":c}),null)}}))}const Le=(e,c=0)=>{if(xe)return N||We(),e=Array.isArray(e)?{images:e,startPosition:c}:e,N.open(Te({},Ne,e)),N};export{Le as s};
