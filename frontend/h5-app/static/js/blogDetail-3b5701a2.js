import{d as J,u as re,O as ce,k as ue,P as C,r as g,J as de,o as me,f as c,b as l,s as ve,c as z,w as d,e as o,t as a,m as pe,j as f,aE as q,F as j,g as P,x as v,av as _e,L as ge,B as fe,I as ye,a as i,h as $,aw as he,_ as xe}from"./index-b744bed0.js";import{F as we}from"./index-ede2df1d.js";import{E as ke}from"./index-479e4c76.js";import{g as be,a as Ie,u as Ce,f as $e,b as Se,d as Le}from"./index-58f473f0.js";import{g as H}from"./auth-22cde164.js";import{u as De}from"./useLike-4f904da7.js";import{I as Fe}from"./index-beccc506.js";import{a as Be,S as Te}from"./index-515de819.js";import{s as Ue}from"./function-call-69531997.js";const ze={class:"blog-detail bg-[--color-block-background] min-h-screen pb-[80px]"},je={key:1,class:"main-container mt-[20px] py-[20px] mb-[20px]"},Pe={class:"flex items-center mb-[15px]"},Ae={class:"ml-[10px]"},Ne={class:"font-medium"},Me={class:"text-[12px] text-[--van-gray-6]"},Re={class:"ml-auto"},Ve={class:"text-[18px] font-bold mt-[15px] mb-[10px]"},Oe={class:"mt-[15px] text-[15px] leading-relaxed"},Ee={key:0,class:"mt-[15px] relative"},qe={class:"custom-indicator left-indicator"},He={class:"custom-indicator right-indicator"},Je={key:0,class:"image-counter"},We={class:"flex items-center justify-between mt-[20px] pb-[15px] border-b border-[--van-gray-3]"},Ye={class:"flex items-center"},Ge={class:"ml-[5px]"},Ke={class:"flex items-center ml-[20px]"},Qe={class:"ml-[5px]"},Xe={class:"mt-[15px]"},Ze={class:"font-bold text-[16px] mb-[10px]"},et={key:0,class:"flex flex-col items-center py-[30px]"},tt={key:1},st={class:"flex"},ot={class:"ml-[10px] flex-1"},at={class:"font-medium text-[14px]"},nt={class:"mt-[5px] text-[14px]"},lt={class:"mt-[5px] flex justify-between items-center"},it={class:"text-[12px] text-[--van-gray-6]"},rt={class:"flex"},ct=["onClick"],ut=["onClick"],dt={key:0,class:"ml-[10vw] mt-[10px]"},mt={class:"flex"},vt={class:"ml-[10px] flex-1"},pt={class:"font-medium text-[14px]"},_t={class:"mt-[5px] text-[14px]"},gt={key:0,class:"text-[--van-blue]"},ft={class:"mt-[5px] flex justify-between items-center"},yt={class:"text-[12px] text-[--van-gray-6]"},ht={class:"flex"},xt=["onClick"],wt=["onClick"],kt={class:"fixed bottom-0 left-0 right-0 bg-white border-t border-[--van-gray-3] p-[10px]"},bt=J({name:"BlogDetail"}),It=J({...bt,setup(Ct){const{t:u}=re(),W=ce(),k=ue(),S=C(()=>W.params.id),{handleLike:Y,initLikeStatus:G}=De(),L=g(!0),t=g({}),K=C(()=>t.value.avatar||"https://fastly.jsdelivr.net/npm/@vant/assets/cat.jpeg"),Q=C(()=>t.value.nickname?t.value.nickname:t.value.isOwnBlog?"Me":`User ${t.value.userId}`),X=de();C(()=>X.userId||"");const y=g([]),h=g(""),m=g(null),b=g(!1),A=g(0),N="https://fastly.jsdelivr.net/npm/@vant/assets/cat.jpeg",D=async()=>{try{L.value=!0;const e=await be(S.value);if(e.code===200&&e.data){t.value=e.data,t.value.isLiked&&G(t.value.id,!0),t.value.imageList||(t.value.imageList=[]);const s=H();s&&s.userId===t.value.userId&&(t.value.nickname=s.nickname||"Me",t.value.avatar=s.avatar),await te()}else v(u("community.operationFailed")),setTimeout(()=>{k.back()},1500)}catch(e){console.error("获取博客详情错误:",e),v(u("community.operationFailed")),setTimeout(()=>{k.back()},1500)}finally{L.value=!1}},Z=()=>{Y(t.value)},F=e=>{e&&k.push(`/blog/userSpace/${e}`)},B=async()=>{try{const e=await Ie(S.value);e.code===200&&e.data?(y.value=e.data,y.value.length>0&&console.log("评论列表已加载，检查删除权限")):(y.value=[],console.warn("获取评论失败"))}catch(e){console.error("获取评论列表错误:",e),y.value=[]}},ee=async e=>{e.stopPropagation();try{if(!t.value.userId)return;const s=t.value.isFollowed;t.value.isFollowed=!s,s?await Ce(t.value.userId):await $e(t.value.userId),v(u(s?"community.post.followed":"community.post.follow"))}catch{t.value.isFollowed=!t.value.isFollowed,v(u("community.operationFailed"))}},te=async()=>{try{console.log("博客是否是自己的:",t.value.isOwnBlog),console.log("是否已关注作者:",t.value.isFollowed)}catch(e){console.error("处理关注状态错误:",e)}},se=(e,s)=>{const _=e.map(p=>p.url);Ue({images:_,startPosition:s})},T=e=>{if(!e)return"";const s=new Date(e);return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")} ${String(s.getHours()).padStart(2,"0")}:${String(s.getMinutes()).padStart(2,"0")}`},M=(e,s)=>{s?m.value={id:e.userId,nickname:e.nickname,parentId:s.id}:m.value={id:e.userId,nickname:e.nickname,parentId:e.id},setTimeout(()=>{var _;(_=document.querySelector("input"))==null||_.focus(),window.scrollTo(0,document.body.scrollHeight)},100)},oe=()=>{m.value=null},ae=async()=>{if(!h.value.trim()){v(u("commentInputPlace"));return}try{b.value=!0;const e={blogId:S.value,content:h.value};m.value&&(m.value.parentId&&(e.parentId=m.value.parentId),m.value.id&&(e.replyUserId=m.value.id));const s=await Se(e);s.code===200?(v(u("community.commentSuccess")),h.value="",m.value=null,await B(),await D()):v(u("community.commentFailedWithReason",{message:s.message}))}catch{v(u("commentDeleteRetry"))}finally{b.value=!1}},R=e=>{he({title:u("community.commentDeleteTitle"),message:u("community.commentDeleteConfirmMessage"),showCancelButton:!0,closeOnPopstate:!1}).then(()=>{ne(e)}).catch(()=>{console.log("取消删除")})},V=e=>{const s=H(),_=s==null?void 0:s.userId;if(!_)return console.warn("无法获取当前用户ID，删除权限检查失败"),!1;const p=String(_),x=String(e),I=String(t.value.userId||"");return p===x||p===I},ne=async e=>{try{(await Le(e)).code===200?(v(u("commentDeleteSuccess")),await B(),await D()):v(u("commentDeleteFailed"))}catch{v(u("commentDeleteRetry"))}};return me(async()=>{await D(),await B()}),(e,s)=>{const _=_e,p=ge,x=Fe,I=fe,O=Te,w=ye,E=Be,le=ke,ie=we;return i(),c("div",ze,[l(_,{title:e.$t("community.post.blogDetail"),"left-arrow":"",fixed:"",placeholder:"",onClickLeft:s[0]||(s[0]=n=>ve(k).back())},null,8,["title"]),L.value?(i(),z(p,{key:0,class:"py-[100px]",size:"24px",vertical:""},{default:d(()=>[$(a(e.$t("common.loading")),1)]),_:1})):(i(),c("div",je,[o("div",Pe,[l(x,{round:"",width:"10vw",height:"10vw",src:K.value,onClick:s[1]||(s[1]=n=>F(t.value.userId))},{loading:d(()=>[l(p,{type:"spinner",size:"20"})]),_:1},8,["src"]),o("div",Ae,[o("div",Ne,a(Q.value),1),o("div",Me,a(T(t.value.createTime)),1)]),o("div",Re,[t.value.isOwnBlog===!1?(i(),z(I,{key:0,round:"",size:"small",type:t.value.isFollowed?"default":"primary",plain:!t.value.isFollowed,onClick:pe(ee,["stop"])},{default:d(()=>[$(a(t.value.isFollowed?e.$t("community.post.followed"):e.$t("community.post.follow")),1)]),_:1},8,["type","plain"])):f("",!0)])]),o("div",Ve,a(t.value.title),1),o("div",Oe,a(t.value.content),1),t.value.imageList&&t.value.imageList.length>0?(i(),c("div",Ee,[l(E,{"show-indicators":t.value.imageList.length>1,autoplay:0,loop:t.value.imageList.length>1,"indicator-color":"white",class:"w-full",onChange:s[2]||(s[2]=n=>A.value=n)},q({default:d(()=>[(i(!0),c(j,null,P(t.value.imageList,(n,r)=>(i(),z(O,{key:r},{default:d(()=>[l(x,{width:"100%",height:"auto",src:n.url,onClick:U=>se(t.value.imageList,r)},{loading:d(()=>[l(p,{type:"spinner",size:"20"})]),_:2},1032,["src","onClick"])]),_:2},1024))),128))]),_:2},[t.value.imageList.length>1?{name:"prev",fn:d(()=>[o("div",qe,[l(w,{name:"arrow-left",size:"20"})])]),key:"0"}:void 0,t.value.imageList.length>1?{name:"next",fn:d(()=>[o("div",He,[l(w,{name:"arrow",size:"20"})])]),key:"1"}:void 0]),1032,["show-indicators","loop"]),t.value.imageList.length>1?(i(),c("div",Je,a(A.value+1)+"/"+a(t.value.imageList.length),1)):f("",!0)])):f("",!0),o("div",We,[o("div",Ye,[o("div",{class:"flex items-center",onClick:Z},[l(w,{name:t.value.isLiked?"good-job":"good-job-o",color:t.value.isLiked?"#ff5000":"",size:"20"},null,8,["name","color"]),o("div",Ge,a(t.value.liked||0),1)]),o("div",Ke,[l(w,{name:"comment-o",size:"20"}),o("div",Qe,a(t.value.comments||0),1)])])]),o("div",Xe,[o("div",Ze,a(e.$t("community.post.comments"))+" ("+a(t.value.comments||0)+") ",1),y.value.length?(i(),c("div",tt,[(i(!0),c(j,null,P(y.value,n=>(i(),c("div",{key:n.id,class:"comment-item mb-[15px] pb-[15px] border-b border-[--van-gray-3]"},[o("div",st,[l(x,{round:"",width:"10vw",height:"10vw",src:n.avatar||N,onClick:r=>F(n.userId)},{loading:d(()=>[l(p,{type:"spinner",size:"20"})]),_:2},1032,["src","onClick"]),o("div",ot,[o("div",at,a(n.nickname),1),o("div",nt,a(n.content),1),o("div",lt,[o("div",it,a(T(n.createTime)),1),o("div",rt,[V(n.userId)?(i(),c("div",{key:0,onClick:r=>R(n.id),class:"delete-btn text-[12px] text-[--van-gray-6] mr-[15px]"},a(e.$t("community.post.delete")),9,ct)):f("",!0),o("div",{onClick:r=>M(n),class:"reply-btn text-[12px] text-[--van-gray-6]"},a(e.$t("community.post.reply")),9,ut)])])])]),n.children&&n.children.length>0?(i(),c("div",dt,[(i(!0),c(j,null,P(n.children,r=>(i(),c("div",{key:r.id,class:"child-comment-item mt-[10px] pt-[10px] border-t border-[--van-gray-3]"},[o("div",mt,[l(x,{round:"",width:"8vw",height:"8vw",src:r.avatar||N,onClick:U=>F(r.userId)},{loading:d(()=>[l(p,{type:"spinner",size:"20"})]),_:2},1032,["src","onClick"]),o("div",vt,[o("div",pt,a(r.nickname),1),o("div",_t,[r.replyUserNickname?(i(),c("span",gt,"@"+a(r.replyUserNickname),1)):f("",!0),$(" "+a(r.content),1)]),o("div",ft,[o("div",yt,a(T(r.createTime)),1),o("div",ht,[V(r.userId)?(i(),c("div",{key:0,onClick:U=>R(r.id),class:"delete-btn text-[12px] text-[--van-gray-6] mr-[15px]"},a(e.$t("community.post.delete")),9,xt)):f("",!0),o("div",{onClick:U=>M(r,n),class:"reply-btn text-[12px] text-[--van-gray-6]"},a(e.$t("community.post.reply")),9,wt)])])])])]))),128))])):f("",!0)]))),128))])):(i(),c("div",et,[l(le,{description:e.$t("community.post.noComments")},null,8,["description"])]))])])),o("div",kt,[l(ie,{modelValue:h.value,"onUpdate:modelValue":s[3]||(s[3]=n=>h.value=n),placeholder:m.value?e.$t("community.post.replyToPlaceholder",[m.value.nickname]):e.$t("community.post.commentPlaceholder"),rules:[{required:!0,message:e.$t("community.post.contentRequired")}],autocomplete:"off"},q({button:d(()=>[l(I,{size:"small",type:"primary",onClick:ae,disabled:!h.value.trim()||b.value},{default:d(()=>[$(a(b.value?e.$t("community.post.sending"):e.$t("community.post.send")),1)]),_:1},8,["disabled"])]),_:2},[m.value?{name:"left-icon",fn:d(()=>[l(w,{name:"close",onClick:oe})]),key:"0"}:void 0]),1032,["modelValue","placeholder","rules"])])])}}});const jt=xe(It,[["__scopeId","data-v-913a3e44"]]);export{jt as default};
